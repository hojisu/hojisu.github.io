# 이상 탐지 (Anomaly Detection)

이상 탐지(Anomaly Detection)이란 예상되거나 기대하는 관찰값, item, event가 아닌 데이터 패턴(이상징후, anomalies), 개체(이상값) 등을 찾아내는 것을 말한다. 

이상 탐지 기법은 특정 알고리즘이 있는 것이 아니라 "기대하는 결과"를 얻기 위해 여러 가지 알고리즘과 분석론을 활용한 분석을 의미한다. 
어떤 데이터인지, 어떤 분야인지, 목적은 무엇인지 등에 따라 매우 광범위하고 다양한 방법들이 활용되고 있기 때문에 정해진 기법이나 모델을 사용하는 게 아니라 활용 가능한 모든 방안들을 사용할 수 있다. 


### 이상 탐지 목적
- Chance Discovery의 목적
  - 예 : 새로운 고객 층의 발견, 보험 상품의 개발, segmentation이 필요할 때
- Fault Discovery의 목적
  - 예 : 불량율이 증가하는 장비, 공정 탐지 등
- Novelty Detection : 새로운 것을 찾기 위해
  - 예 : 보안 분야의 새로운 침입 패턴 탐지
- Noise Removal 노이즈 제거
  - 예 : 잘못 입력된 값이나 대표성이 없는 극단값의 자동 제거

### 이상 탐지 이슈
- 정상과 이상 상태를 명확하기 정의하기 어렵다. 이상 패턴은 정상 패턴과 매우 유사한 패턴을 보일 수 있다.
- 알려진 이상값, 이상 패턴과 전혀 다른 이상값, 이상 패턴이 발생할 수 있다.
- 양질의 training/validation 데이터 셋을 확보하기가 어렵다.
- 정상 패턴도 시간, 상황에 따라 변한다.
- 이상 탐지의 대상 변수가 너무 많고 데이터의 양도 방대하다.


### Anomaly Detection 기법 

#### 기계학습 기반의 이상 탐지

**군집(Clustering)기반 이상 탐지 기법** 

- 이상값 가정 1: 정상값들은 하나 또는 몇 개의 군집에 모여 있고, 이상값은 군집에 속하지 않는다. 
  - 데이터에서 군집을 찾아낸 후 제거한 뒤 남아있는 데이터를 이상값으로 처리한다. 
    - DBSCAN
    - ROCK
    - SNN 군집화
- 이상값 가정 2: 군집의 중심(centroid) 중 가장 가까운 것과의 거리가 짧으면 정상값, 길면 이상값이다. 
  - 군집화를 하고 데이터가 포함된 군집의 중심과 데이터 개체 사이의 거리를 이상 score로 두고 이용한다.
    - K-means
    - EM 알고리즘
- 이상값 가정 3: 정상값은 크거나 조밀한 군집에, 이상값은 작거나 sparse한 군집에 속한다.
  - 데이터 개체가 속한 군집의 크기나 밀도가 이상여부를 판단란다. 
    - CBLOF

**분류(Classification)기반 이상 탐지 기법**
- Neural Network
- Baysian networks
- SVM
- Dicision rule

**Nearest neighbor 기반 이상 탐지 기법**
NN 기법은 정상값들은 어떤 근방(neighbor)에 밀집되어 있고, 이상값은 각 근방에서 멀리 떨어져 있다고 가정한다. 
- KNN : 이상 score를 K번째로 가까운 개체와의 거리로 정의
- Local Outlier Factor score : 상대 밀도 기반으로 각 개체 근방의 밀도를 추정하여 근방의 밀도가 낮은 개체를 이상값이라고 판다.

**통계학적 기반의 이상탐지**
통계학적 기반의 이상 탐지 분석에서 anomal 데이터 정의는 `대부분의 데이터가 가지는 확률분포와 부분적으로 또는 완전히 동떨어졌다고 여겨지는 관측값` 으로 정의한다. 
주어진 자료로 모형을 적합한 뒤 통계적 추론을 통해 새로운 데이터가 그 모형을 따르는지를 판단하며 검정 통계량을 바탕으로 테스트 데이터가 해당 모형으로부터 생성되었을 확률이 낮은 데이터를 이상값으로 본다. 

- 모수적 기법 
  - 데이터가 추정된 분포에서 생성되었다는 것을 귀무가설로 한다. 검정 통계량을 이상 score로 활용할 수 있다. 
  - 정규 모형 기반
    - 데이터가 정규모형에서 생성된 것으로 가정하고 MLE 사용한다. 
    - 각 데이터와 추정된 평균값 사이의 거리가 이상 score가 되고 이상 score의 경계를 정해서 이상값 여부 결정한다. 
    - 거리의 정의와 경계를 구하는 방법
      - boxplot
      - Grubbs 검정
      - Mahalanobis 거리
      - 스튜던트 t 검정
      - Hotelling's t검정
      - 카이제곱 검정
  - 회귀 모형 기반
    - 시계열 데이터에 적용하며 데이터의 회귀모형을 적합한 뒤 테스트 데이터와 회귀모형간의 잔차로 이상 score를 구한다.
      - Robust 회귀
      - ARIMA 모형
  - 혼합 모형 기반
    - 데이터에 적용할 분포를 혼합하여 이용한다. 
    - 정상값과 이상값에 각각 다른 분포를 적용하는 방법과 정상값에만 혼합 분포를 적용하는 방법이 있다. 
  
- 비모수적 기법
  - 데이터가 특정 모형을 따른다는 가정을 하지 않는다. 
  - 히스토그램 기반
  - 커널함수 기반

**정보 이론 기반 이상 탐지 기법**
엔트로피, 상대 엔트로피와 같은 척도를 이용하여 데이터의 정보량을 분석한다.
정보이론의 핵심 아이디어는 `잘 일어나지 않는 사건은 자주 발생하는 사건보다 정보량이 많다`는 것이다. 



reference
- http://docs.iris.tools/manual/IRIS-Usecase/AnomalyDetection/AnomalyDetection_202009_v01.html

