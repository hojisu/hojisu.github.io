<script> MathJax.Hub.Queue(["Typeset", MathJax.Hub]); </script>

# K-평균 군집화 K-means Clustering

### Summary

- K-means는 중심값을 선정하고 중심값과 다른 데이터간의 거리를 이용하여 분류를 수행한다. 다음 수행에서는 좀 더 중심에 위치한 중심값을 선정하고, 분류하고 이러한 과정을 반복하여 더이상 분류가 되지 않을 경우에 해당 작업을 종료하게 된다.
- k-means clustering 장점은 알고리즘이 단순해서 비교적 빨리 돌아감, 예측 가능,  새로운 데이터 추가시 빠르게 계산
- k-means clustering 단점은 초기 군집수의 결정을 사용자가 직접 정해야 한다. 사전에 주어진 목적이 없으므로 결과를 해석하는데 있어 어려움이 존재합니다.  구모형, 크기가 같다라고 가정으로 풀기 때문에 그 외 모형은 풀기 어렵다, K 값을 내가 정해줘야함
- K-means ++ 알고리즘은 초기 중심위치를 고를 때 사용하는 알고리즘이다. 
- 미니배치 K-means clustering은 K-means는 유클리드 거리를 이용하여 계산하기 때문에 데이터 수가 많으면 계산량이 늘어난다. 이럴 경우 미니배치 크기 만큼 무작위로 분리하여 K-means clustering 을 한다.
__________________________________

### K-Means 알고리즘 개념

K-means는 모집단 또는 범주에 대한 사전 정보가 없는 경우 주어진 관측 값들 사이의 거리 또는 유사성을 이용하는 분석법이다. 전체 데이터를 몇 개의 집단으로 그룹화하여 각 집단의 성격을 파악함으로써 데이터 전체의 구조에 대한 이해를 돕고자 하는 분석법이다.

데이터의(Training Set) 기준점(code-vector) 중심을 Euclidean거리가 최소가 되도록 K개의 묶음으로 군집(clustering)하여 분류하는 데이터 마이닝 기법이다. 주어진 데이터를 사전 정의된(사용자가 지정) k개의 클러스터로 묶는 알고리즘으로 각 클러스터와 거리차이의 분산을 최소화하는 방식으로 동작한다.

군집(clustering)별 중심 값에서 중심과의 거리를 기반으로 데이터를 분류하는 군집분석 기법이다. 입력 값으로 K를 취하고 군집 내 유사성은 높게, 군집간 유사성은 낮게 되도록 N개의 객체집합을 K개의 군집으로 군집하는 기법이다.

### K-Means 알고리즘의 특징

- 거리기반 분류 : 중심점과의 유클리디안 거리 최소화
- 반복작업 : 초기의 잘못된 병합을 알고리즘을 반복 수행하여 회복
- 짧은 계산시간: 간단한 알고리즘이며 대규모 적용 가능
- 탐색적 기법: 주어진 자료에 대한 사전정보 없이 의미 있는 자료구조를 찾아낼 수 있음

### K-Means 알고리즘 수행절차

1. 군집의 수 K를 정의 및 초기 K의 군집의 중심(Centroid) 선택한다.
2. 각 관측 값들을 가장 가까운 중심의 군집에 할당한다.
3. 새로운 군집의 중심 계산한다.
4. 재정의 된 중심값 기준으로 다시 거리기반의 군집 재불류, 경계가 변경되지 않으면 종료한다.

### K-Means 장단점
1)장점

##### 탐색적인 기법
군집분석은 그 자체가 대용량 데이터에 대한 탐색적인 기법으로 주어진 데이터의 내부구조에 대한 사전적인 정보 없이 의미있는 자료구조를 찾아낼 수 있는 방법이다.

##### 다양한 형태의 데이터에 적용가능
분석을 위해 기본적으로 관찰치 간의 거리를 데이터 형태에 맞게만 정의하면 거의 모든 형태의 데이터에 대하여 적용 가능한 방법이다.

##### 분석방법의 적용 용이성
대부분의 군집방법이 분석대상 데이터에 대해 사전정보를 거의 요구하지 않는다. 적용 유리 즉, 모형화를 위한 분석과 같이 사전에 특정 변수에 대한 역할 정의가 필요하지 않고 다만 관찰치들 사이의 거리만이 분석에 필요한 입력자료로 사용

2) 단점

##### 가중치와 거리 정의
군집분석의 결과는 관찰치 사이의 비 유사성인 거리 또는 유사성을 어떻게 정의하느냐에 따라 크게 좌우, 따라서 관찰치 들 사이의 거리를 정의하고 각 변수에 대한 가중치를 결정하는 것은 매우 어려운 문제다

##### 초기 군집수의 결정
k-평균 군집분석에서는 사전에 정의된 군집수를 기준 으로 동일한 수의 군집을 찾게 되므로 만일 군집수 k 가 원 데이터구조에 적합하지 않으면 좋은 결과를 얻을 수 없음

##### 결과해석의 어려움
탐색적인 분석방법으로의 장점을 가지고 있는 반면에 사전에 주어진 목적이 없으므로 결과를 해석하는데 있어서 어려움 존재 

### K-means 알고리즘 활용 분야

- Data Mining에서 데이터 분류 및 군집 알고리즘으로 활용할 수 있다.
- 트랜드 또는 성향이 불분명한 시장을 분석하는 경우이다.
- 시장과 고객분석, 패턴인식, 공간데이터 분석, Text Mining 등이 있다.
- 최근에는 패턴인식, 음성인식의 기본 알고리즘으로 활용되어 지고 있다.
- 개체가 불규칙적이고, 개체간 관련성을 정확히 알 수 없는 분류 초기 단계에 사용할 수 있다.

### K-평균 군집화

아래의 목적함수 값이 최소화 될 때까지 군집의 중심위치(데이터와 가까운 중심위치를 선택한다)와 각 데이터가 소속될 군집을 반복해서 찾는다. 이 값을 관성(inertia, 중심위치와의 거리의 총합)이라 한다.

$$
J = \sum^K_{k=1} \sum_{i \in C_k} d(x_i, \mu_k)
$$

$$K$$ 는 군집의 갯수(사용자가 지정해줘야함), $$C_k$$ (내가 정한 데이터)는 $$k$$ 번째 군집에 속하는 데이터의 집합, $$\mu_k$$ 는 $$k$$ 번째 군집의 중심위치(centroid), $$d$$ 는 $$x_i, \mu_k$$ 두 데이터 사이의 거리 혹은 비유사도(dissimilarity)로 정의한다. 만약 유클리드 거리를 사용한다면 다음과 같다.

$$
d(x_i, \mu_k) = ||x_i - \mu_k||^2
$$

위 식은 다음처럼 표현할 수도 있다. (sklearn 문서 가이드 출저 공식) 자기와 가장 가까운 중심위치를 골라본다.

$$
J = \sum_{i=1}^{N}\min_{\mu_j \in C}(||x_i - \mu_j||^2)
$$

세부 알고리즘은 다음과 같다.

1. 임의의 중심위치 $$\mu_k \ (k=1,\dots, K)$$ 를 고른다. 보통 데이터 표본 중에서 $$K$$ 를 선택한다. 
2. 모든 데이터 $$x_i \ (i=1, \dots, N)$$ 에서 각각의 중심위치 $$\mu_k$$ 까지의 거리를 계산한다. 
3. 각 데이터에서 가장 가까운 중심위치를 선택하여 각 데이터가 속하는 군집을 정한다.
4. 각 군집에 대해 중심위치 $$\mu_k$$ 를 다시 계산한다. (클러스터가 정해진 후 그 클러스터에 속한 데이터들의 평균으로 중심위치를 계산한다.)
5. 2~4번을 반복한다. 

K-평균 군집화란 명칭은 각 군집의 중심위치를 구할 때 해당 군집에 속하는 데이터 평균(mean)값을 사용하는데서 유래하였다. 만약 평균 대신 중앙값(median)을 사용하면(데이터에서 그 중심을 꼭 정하라는 제한조검 있을 시) K-중앙값(K-median) 군집화라 한다. 

K-평균 군집화는 항상 수렵하지만 최종 군집화 결과가 전역 최적점이라는 보장은 없다. 군집화 결과는 초기 중심위치에 따라 달라 질 수 있다.

K-평균 군집화는 유클리드 거리를 사용하므로 너무 차원이 높을 때는 군집화 성능이 떨어질 수 있다. 이때는 차원축소를 한 후 군집화를 하는 것이 도움이 될 수 있다. 

### K-평균 ++ 알고리즘 (K-means ++ )

K-평균 ++ 알고리즘은 초기 중심위치를 설정하기 위한 알고리즘이다. 아래의 방법으로 멀리 떨어진 중심위치 집합을 찾아낸다. 
1. 중심위치를 저장할 집합 $$M$$ 준비
2. 일단 하나의 중심위치 $$\mu_0$$ 를 랜덤하게 선택하여 $$M$$ 에 넣는다.
3. $$M$$ 에 속하지 않는 모든 표본 $$x_i$$ 에 대해 거리 $$d(M, x_i)$$ 를 계산. $$d(M,x_i)$$ 는 $$M$$ 안의 모든 샘플 $$\mu_k$$ 에 대해 $$d(\mu_k, x_i)$$ 를 계산하여 가장 작은 값 선택
4. $$d(M, x_i)$$ 에 비례한 확률로 다음 중심위치 $$\mu$$ 를 선택.
5. $$K$$ 개의 중심위치를 선택할 때까지 반복
6. K-평균 방법 사용

### 미니배치 K-평균 군집화

데이터의 수가 너무 많을 때는 미니배치 K-평균(Mini batch K-means) 군집화 방법을 사용하면 계산량을 줄일 수 있다. 
-  데이터를 미니배치 크기만큼 무작위로 분리하여 K-평균 군집화를 한다. 
-  모든 데이터를 한꺼번에 썼을 때와 결과가 다를 수는 있지만 큰 차이가 없다. 

